<!DOCTYPE html>
{% extends 'blog/base.html' %}
{% load static %}

{% block header %}
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport"
              content="width=device-width, initial-scale=1, maximum-scale=1"/>
        <link href="{% static 'blog/css/jquery.fancybox.min.css' %}"
              rel="stylesheet" type="text/css"/>
        <link href="{% static 'blog/css/font-awesome.min.css' %}"
              rel="stylesheet" type="text/css"/>
        <link href="{% static 'blog/css/main.css' %}" rel="stylesheet"
              type="text/css"/>
        <link rel="shortcut icon" type="image/x-icon"
              href="{{ blog_meta.ico.image.url }}"/>
        <script src="{% static 'blog/js/pace.min.js' %}"></script>
        <title> {{ blog_meta.name }} </title>
        <link href="{% static 'blog/css/pace-theme-flash.css' %}"
          rel="stylesheet"/>
        <link href="{% static 'blog/css/pace-user-define.css' %}"
          rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="{% static 'blog/css/editor-style.css' %}"/>
        <link rel="stylesheet" href="{% static 'blog/css/editormd.min.css' %}"/>
    </head>
{% endblock %}

{% block body %}
    <body class="pace-done">

    {% block progressbar %}
        {% include 'blog/units/progress-bar.html' %}
    {% endblock %}

    {% include 'blog/units/content-header.html' %}
    <form class="" action="{% url 'app:editor' %}" method="post">
        {% csrf_token %}
        <div>
            {{ form.title.label_tag }}
            {{ form.title }}
        </div>
        <div>
            {{ form.abstract.label_tag }}
            {{ form.abstract }}
        </div>
        <div>
            {{ form.status.label_tag }}
            {{ form.status }}
        </div>
        <div id="new-editormd">
            {{ form.body }}
        </div>
        <div>
            {{ form.topped.label_tag }}
            {{ form.topped }}
        </div>
       <div>
            {{ form.category.label_tag }}
            {{ form.category }}
        </div>
        <div>
            {{ form.tags.label_tag }}
            {{ form.tags }}
        </div>
      <button type="submit" class="post-button"> 发表 </button>
    </form>

    {% block script %}
        <script src="{% static 'blog/js/jquery.min.js' %}"></script>
        <script src="{% static 'blog/js/editormd/editormd.min.js' %}"></script>
        <script type="text/javascript">
            var newEditor;
            var theme = "default";
            var mirrorTheme = "default";
            var previewTheme = "default";
            $(function () {
                newEditor = editormd("new-editormd", {
                    width: "95%",
                    height: 900,
                    syncScrolling: "single",
                    path: "{% static 'blog/js/editormd/lib/' %}",
                    imageUpload: true,
                    imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
                    imageUploadURL: "/images/",
                    ToolbarAutoFixed: true,
                    taskList: true,
                    emailLink: true,
                    emoji: true,
                    flowChart: true,
                    gotoLine: true,
                    tex: true,
                    toolbarIcons : function() {
                        return ["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","||","themeIcon","help","info"]
                    },
                    toolbarIconsClass : {
                        themeIcon : "fa-adjust"
                    },
                    toolbarHandlers : {
                        themeIcon : function(cm, icon, cursor, selection) {
                            if (theme === "default") {
                                theme = "dark";
                                mirrorTheme = "pastel-on-dark";
                                previewTheme = "dark";

                            }else{
                                theme = "default";
                                mirrorTheme = "default";
                                previewTheme = "default";
                            }
                            newEditor.setTheme(theme);
                            newEditor.setCodeMirrorTheme(mirrorTheme);
                            newEditor.setPreviewTheme(previewTheme);
                        }
                    },
                    lang : {
                        toolbar : {
                            themeIcon : "主题(default/dark)"  // 自定义按钮的提示文本，即title属性
                        }
                    }
                });
            });
        </script>
    {% endblock %}
    </body>
{% endblock %}